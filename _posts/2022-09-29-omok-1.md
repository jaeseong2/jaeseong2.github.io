---
title: 오목 AI - 1. 렌주룰 및 게임보드 구현
date: 2022-09-28 23:42:00 +0900
categories: [Projects]
tags: [ml, rl, omok]
---

[Project Link](https://github.com/jaeseong2/omok-ai)

## 오목과 렌주룰

오목은 우리가 어릴 때부터 즐겨해오던 단순한 게임이다. 흑이 먼저 수를 두고 백이 그 다음 수를 두게 된다. 이 과정을 반복해서 5개의 돌을 일렬로 두면 승리한다. 하지만 흑이 먼저 수를 두기 때문에 흑이 유리하다. 그래서 밸런스를 맞추기 위한 규칙들이 존재하는데, 그 중에 보편적인 것이 렌주룰이다.

렌주룰에서는 흑에게만  3-3, 4-4, 장목이 금수(금지 수)이다. 백일 때는 앞에서의 3-3이나 4-4가 모두 허용된 수이고, 장목을 뒀을 때도 오목과 마찬가지로 승리로 판단한다.
사실 이러한 제한이 있어도 흑에게 조금 더 유리하다고 한다.

## 렌주룰을 포함한 게임보드 구현

먼저, 금수를 제외한 전체적인 게임을 구현하는 것은 크게 어렵지 않다. 문제는 3-3, 4-4, 장목과 같은 금수 판별이다. 사실 어떤 포인트에 착수가 되고 난 이후에 그때 모든 방향에 대해 서칭하면서 금수를 판별하는 것은 조금 귀찮지만 어렵지 않다. 하지만 이전에 프로젝트를 진행할 때는 이 금수를 판별하는 과정이 게임을 진행하는데에 가장 오래 걸리는 부분이기 때문에 이 부분의 시간을 줄인다면 학습 시간도 줄일 수 있지 않을까라고 생각해서 최대한 빠르게 금수를 판별할 수 있는 알고리즘을 고민했다.

그때 우리가 고민했던 방법은 미리 패턴들을 정리하고 착수가 될 때마다 금수 후보지를 계속 관리해가면서 금수를 판단하는 것이었다. 그때 꽤 많은 패턴들을 정리했던 것 같은데 지금 생각해보니 잘 떠오르지 않아서 이 정도로 밖에 설명을 못하겠다. 결과적으로 실패를 했고, 대신에 렌주룰에 대해 더 깊게 알게 되었다. 좋은건가..?

지금은 착수가 된 이후에 금수를 판별하는 방식으로 구현을 했다. 대신, 보드의 모든 영역에서 금수를 체크하기 보다 착수한 지점이 영향을 미칠 수 있는 범위 내의 지점에서만 기존의 금수를 확인하고, 새로운 금수를 추가했다.

```python
start_row, end_row = max(0, row - 5), min(BOARD_SIZE, row + 5)
start_col, end_col = max(0, col - 5), min(BOARD_SIZE, col + 5)

for row in range(start_row, end_row):
    for col in range(start_col, end_col):
        if self.board[row][col] == PointStateEnum.EMPTY:
            if self.check_forbidden(row, col):
                self.board[row][col] = PointStateEnum.FORBIDDEN
                self.forbidden_points.append((row, col))
        elif self.board[row][col] == PointStateEnum.FORBIDDEN:
            if not self.check_forbidden(row, col):
                self.board[row][col] = PointStateEnum.EMPTY
                self.forbidden_points.remove((row, col))
```

지금 돌이켜 생각해보면 이렇게 판단하더라도 착수가 된 후에 판별하는 알고리즘과 복잡도에서 크게 다르지 않을 것 같다.

먼저, 3-3 금수의 경우에는 라인의 끝에 있는 빈 포인트를 찾아 그 지점에 두었다고 가정했을 때 그 지점을 기준으로 모든 방향에서 열린 3이 두개 이상 나오면 그 자리는 금수이다. 말이 길어져서 조금 어려운 것 같은데 4-4 금수에 비해 훨씬 쉬운 편이다.
4-4의 경우에는 3-3의 교차된 형태에서 조금 더 많은 부분을 포함한다. 특이한 형태로 일렬로 금수가 생성되는 경우도 있다. 또한, 열린 3과는 다르게 닫힌 4 역시도 4-4 금수에 포함된다.
장목은 그 지점이 포함되었다고 가정했을 때, 일렬로 늘어선 돌이 6개 이상인 것만 체크하면 된다.
[이 부분에 해당하는 코드](https://github.com/jaeseong2/omok-ai/blob/main/game/game.py)는.. 좀 길 것 같아서 생략하는게 좋겠다.

생각보다 빠르게 렌주룰 구현을 끝내고 나서, 이전에 플젝을 할 때 작성해뒀던 테스트를 지금 코드에 맞게 약간 수정하고 제대로 금수 체크를 하는지 확인해보았다. 대부분 제대로 하는 것 같으나 몇몇 부분에서 차이가 난다. 거짓 금수를 모르고 테스트 리소스에 넣어뒀을 수도 있기 때문에 조금 더 자세히 봐야할 것 같다. 어차피 테스트는 조금 더 수정해야해서 다음에 같이 보는게 좋겠다.

강화학습은 이전에 들었던 강의를 복습하면서 조금 더 공부할 시간이 필요할 것 같아 다음 스텝으로는 파이게임을 붙여서 인터페이스를 만드려고 한다.